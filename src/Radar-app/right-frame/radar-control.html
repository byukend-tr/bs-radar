<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/notification-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/paper-spinner/paper-spinner.html">

<dom-module id="radar-control">
    <template>
        <style>
             :host {
                display: block;
                background-color: rgba(0, 0, 0, 0.8);
                height: 100%;
            }
            /*app-header-layout {
                padding-bottom: 0px;
                margin-bottom: 0px;
            }*/

            app-header {
                position: inherit;
                width: 100%;


                /*@apply(--layout-fixed-top);*/
            }

            app-toolbar {
                height: 20%;
                /*background-color: rgba(0, 0, 0, 0.8);*/
                padding-left: 2%;
                color: whitesmoke;
            }


            paper-icon-button {
                --paper-icon-button-ink-color: white;
            }

            iron-icon {
                margin-right: 2%;
                padding-right: 5%;
            }

            iron-icon.common {
                --iron-icon-height: 32px;
                --iron-icon-width: 32px;
            }

            ul {
                margin-top: 0;
                margin-bottom: 0%;
                padding: 0;
                list-style: none;
            }

            app-drawer {
                --app-drawer-content-container: {
                    position: fixed;
                    color: black;
                    top: 135px;
                    bottom: 355px;
                    /*margin-right:0.59%;*/
                    margin-right: 10.2px;

                    padding: 20px;
                }
            }

            .drawer-head {
                text-align: left;
                margin-left: 10%;
            }

            #time {
                padding-left: 1%;
                font-size: 16px;
                /*border-bottom: 2px solid*/
            }

            .main {
                margin-top: -15.75%;
                padding: 3%;
                /*background-color: rgba(0, 0, 0, 0.8);*/
                /*height: 450px;*/
                color: white;
            }

            app-drawer div.title {
                font-size: 28px;
                text-align: left;
                cursor: default;
            }

            paper-item.showtime {
                width: 98%;
                left: -20px;
                padding-left: 30px;
                cursor: pointer;
            }

            hr {
                background-color: white
            }

            paper-listbox {
                padding: 0;
            }

            .opt {
                color: rgba(255, 255, 255, 0.5)
            }

            p {
                font-size: 12px;
                padding-left: 10px;
            }

            h3 {
                display: inline-block;
            }

            .download {
                padding-top: 145px;
            }

            .download paper-button {
                background: #43A047;
                width: 25%;
            }
        </style>

        <app-drawer-layout id='layout' force-narrow>
            <app-drawer id='drawer' slot='drawer' align='right' opened>
                <div class='title'><b>Timeline
                    <iron-icon icon='icons:timeline'></iron-icon></b>
                </div>
                <hr></hr>
                <paper-listbox class='menu' attr-for-selected="value" selected={{option}} id='listbox'>
                    <paper-item class='showtime' value='The past hour' drawer-toggle>The past hour</paper-item>
                    <paper-item class='showtime' value='The past 2 hours' drawer-toggle>The past 2 hours</paper-item>
                    <paper-item class='showtime' value='The past 12 hours' drawer-toggle>The past 12 hours</paper-item>
                    <paper-item class='showtime' value='Custom' drawer-toggle>Custom</paper-item>

                </paper-listbox>


            </app-drawer>
            <app-header-layout>
                <app-header slot="header" disabled>

                    <!--<app-toolbar>
                        <paper-progress value="30" indeterminate bottom-item></paper-progress>
                    </app-toolbar>-->
                    <app-toolbar>
                        <!--<iron-icon class='common' icon="track-changes"></iron-icon>-->
                        <div main-title>
                            <h1>Panel <small class='opt'><small><small>[[option]]</small></small>
                                </small>
                            </h1>

                        </div>
                        <div>
                            <paper-icon-button id='drawerButton' icon='menu' drawer-toggle></paper-icon-button>
                        </div>
                        <!--<paper-progress value="30" indeterminate bottom-item></paper-progress>-->
                    </app-toolbar>
                    <app-toolbar>
                        <div id="time">Current timestamp : [[date]]</div>
                    </app-toolbar>
                    <hr></hr>

                </app-header>
            </app-header-layout>
        </app-drawer-layout>

        <div class='main'>
            <h2>Information :</h2>

            <table style="padding-left:20px">
                <tr height="40">
                    <th>
                        Time range
                    </th>
                </tr>
                <tr>
                    <td style="padding-left:10px">From </td>
                    <td>:</td>
                    <td style="padding-left:5px"> [[t1]] </td>
                </tr>
                <tr>
                    <td style="padding-left:10px">To </td>
                    <td>:</td>
                    <td style="padding-left:5px"> [[t2]] </td>
                </tr>
                <tr height="40">
                    <th>
                        Total Frame
                    </th>
                    <td>:</td>

                    <td style="padding-left:5px">
                        [[max]]
                    </td>
                </tr>

                <tr height="40">
                    <th>
                        Current Frame
                    </th>
                    <td>:</td>
                    <td style="padding-left:5px">
                        #[[ratio]]
                    </td>
                </tr>
            </table>
            <!--<paper-spinner id="spin" alt="Processing..." active></paper-spinner>-->
            <div class="download">
                <paper-button on-tap="_downloadAll" raised>
                    <iron-icon icon='icons:archive'></iron-icon>download all</paper-button>
                <paper-button on-tap="_download" raised>
                    <iron-icon icon='icons:archive'></iron-icon>download current</paper-button>
            </div>
        </div>


    </template>

    <script>
        Polymer({
            is: 'radar-control',
            properties: {
                imgList: JSON,
                image: {
                    type: String,
                },
                max: Number,
                ratio: Number,
                ts: String,
                play: {
                    type: String,
                    value: 'av:pause-circle-outline',
                },
                date: {
                    type: String,
                },
                option: {
                    value: 'The past 2 hours',
                    observer: '_timechanged'
                },
                t1: String,
                t2: String,
                ajax_load: {
                    type: Boolean,
                    observer: 'ajax_load',
                }

            },

            ready: function () {
                ctl_p = this;
                this._secondChange();
            },
            _secondChange() {
                if (typeof mon_p != 'undefined') {
                    this.max = mon_p.max;
                    this.t1 = new Date(mon_p.imgList[0].meta._ts * 1000);
                    this.t2 = new Date(mon_p.imgList[this.max - 1].meta._ts * 1000);
                }

                // console.log("ready")
                this.date = new Date();
                this.async(function () {
                    this._secondChange();
                }.bind(this), 1000);

            },
            _timechanged: function () {
                // console.log(mon_p)     
                if (typeof mon_p == 'undefined') return;
                // this.ajax_load  = mon_p.$.ajaxReq.    

                // console.log(this.$.layout.forceNarrow)
                // if (this.option == 'The past hour') mon_p.min = 144 - 11;
                // else if (this.option == 'The past 2 hours') mon_p.min = 144 - 23;
                // else if (this.option == 'The past 12 hours') mon_p.min = 1;
                if (this.option == 'The past hour') mon_p.last = 13;
                else if (this.option == 'The past 2 hours') mon_p.last = 25;
                else if (this.option == 'The past 12 hours') mon_p.last = 145;
            },
            _test() {
                console.log(this.$.spin)
                console.log(this.$.spin.active)
                this.$.spin.active = !this.$.spin.active;
                // console.log(this.$.spin.active)
            },
            ajax_load() {

            },
            _downloadAll(){
                mon_p.create_zip();
            },
            _download(){
                mon_p._downloadImg();
            }


        });
    </script>
</dom-module>