<link rel="import" href="../polymer/polymer-element.html">

<!--
`<nebula-iconset>` is a custom element that registers a set of SVG icons that can be shared between custom elements.

The element is compatible with iconsets generated with the [Polymer Custom Iconset Generator](https://poly-icon.appspot.com). Generating custom iconsets for your application is recommended to minimize download and memory requirements.

## Import

```html
<link rel="import" href="/bower_components/nebula-icons/nebula-iconset.html">
```

## Usage

Iconsets can be defined anywhere in your application. Each iconset must be identified by a unique name, and the original size of the icon SVG definitions. Icons must be square and have the same original size. If you have icons with different sizes, define multiple iconsets with unique names.

```html
<nebula-iconset name="custom" size="24">
  <svg>
    <defs>
      <g id="add"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></g>
    </defs>
  </svg>
</nebula-iconset>
```

It is recommended that you put iconset definitions in their own import file, and import them in any element that refers to them. HTML Imports will ensure that the resources are only loaded once.

-->
<script>
(function() {
  'use strict'

  // global namespace
  window.Nebula = window.Nebula || {}
  Nebula.IconSets = Nebula.IconSets || new Map()

  // symbols for private members
  const register = Symbol()
  const unregister = Symbol()

  // custom element
  class NebulaIconSet extends Polymer.Element {

    /**
     * Gets the custom element name.
     * @protected
     */
    static get is() { return 'nebula-iconset' }

    /**
     * Gets the Polymer property definitions for data binding.
     * @protected
     */
    static get properties() {
      return {
        /**
         * The global registration name of the iconset.
         */
        name: {
          type: String
        },
        /**
         * The height and width of the icon resources.
         * All icons in the set must share the same dimensions.
         */
        size: {
          type: Number,
          value: 24
        }
      }
    }

    /**
     * A Polymer lifecycle callback invoked when element has been initialized.
     * @protected
     */
    ready() {
      super.ready();
      this.setAttribute('hidden', '')
    }

    /**
     * A custom element lifecycle callback invoked when element has been attached to the DOM.
     * @protected
     */
    connectedCallback() {
      super.connectedCallback()
      this[register]()     
    }

    /**
     * A custom element lifecycle callback invoked when element has been removed from the DOM.
     * @protected
     */
    disconnectedCallback() {
      super.disconnectedCallback()
      this[unregister]()
    }

    /**
    * Registers the iconset with the global registry.
    * @private
    */
    [register]() {
      if (!this.name && this.size) return
      if (Nebula.IconSets.has(this.name) && Nebula.IconSets.get(this.name) !== this) {
        throw Object.assign(new Error(), {
          message: 'An iconset with the specified name already exists',
          detail: {
            name: name
          }
        })
      }

      Nebula.IconSets.set(this.name, this)
    }

    /**
    * Removes the iconset from the global registry.
    * @private
    */
    [unregister]() {
      if (!this.name) return
      if (Nebula.IconSets.get(this.name) === this) {
        Nebula.IconSets.delete(this.name)
      }
    }

  }

  customElements.define(NebulaIconSet.is, NebulaIconSet)
}())
</script>
